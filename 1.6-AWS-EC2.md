# 1.6 AWS EC2

## 1.6.1 Virtualization Basics

- Traditional: Kernel in system runs in Privileged Mode and can operate with
  Hardware
- Emulated Virtualization (Software Virtualization)
  - System runs Host Operating System (or Hypervisor)
  - Each application would run in a Virtual Machine
    - VM would have its own OS, Linux, Windows, etc
    - Virtual allocation of resources, emulated hardware
  - Guest operating systems perform Binary translation to hypervisor for
    privileged calls
    - Incredibly slow performance
- Para-Virtualization
  - Small subset of OS which allow modification
    - Instead of privileged calls, these are re-programmed to be a special user
      call called Hypercalls which call the hypervisor directly.
- Hardware Assisted Virtualization
  - Hardware is aware of virtualization
    - e.g. Calls to CPU go straight to CPU and are re-routed to Hypervisor
    - IO devices like disk and network cards appear as physical devices to VM,
      however are routed back to physical software calls in the hypervisor
- SR-IOV (Single Root IO Virtualization)
  - High level: Allows a network (or any other addon card) to present itself as
    several mini cards. As far as hardware is concerned, these are separate
    cards
    - Presented to the guest VMs as real cards and no translation needed between
      hypervisor
    - In EC2, this is called Enhanced Networking

## 1.6.2 EC2 Architecture and Resilience

- EC2 Instances are virtual machines (OS+Resources)
- Run on EC2 Hosts
  - Shared Hosts
    - Shared (but sandboxed) with other customers
  - Dedicated Hosts
    - Own dedicated host
- EC2 Host runs in 1AZ
  - AZ Fails, Host Fails, Instance fails

### What's EC2 Good For?

- Traditional OS+Application Compute
- Long-running Compute
- Server Style Applications (Traditional OS waiting for traffic)
  - either burst or steady-state load
- Monolithic application stacks
- Migrated application workloads or disaster recovery

## 1.6.3 EC2 Instance Types

- Choosing instance types affects:
  - Raw CPU, Memory, Local Storage Capacity & Type
  - Resource Ratios (CPU:RAM, etc etc)
  - Storage and Data Network Bandwidth
  - System Architecture / Vendor (arm, intel, etc)
  - Additional Features and Capabilities
    - GPUS
    - FPGA - programmable CPU
- Categories:
  - General Purpose (Default)
    - Diverse workloads, equal resource ratio
  - Computed optimised
    - Media Processing, HPC, Scientific Modelling, gaming, ML
  - Memory optimised
    - Processing large in-memory datasets, some db workloads
  - Accelerated computing
    - Hardware GPU, FPGA
  - Storage optimised
    - Sequential and Random IO
      - Scale-out transactional db, data warehousing, elasticsearch, analytics
        workloads.

### Decoding EC2 Types

- e.g. `R5dn.8xlarge`
  - `R` - instance family
  - `5` - instance generation
  - `dn` - additional capabilities
    - `a` - amd cpu
    - `d` - nvme storage
    - `n` - network optimised
    - `e` - extra capacity (RAM, storage)
  - `8xlarge` - instance size

## 1.6.4 EC2 Storage

- Key Terms
  - Direct (local) attached storage
    - Storage on the EC2 Host
  - Network attached storage
    - Volumes delivered over the network (EBS)
  - Ephemeral storage
    - temporary storage
  - Persistent storage
    - Permanent storage
    - Lives on past the lifetime of instance
  - Block storage
    - Volume presented to the OS as a collection of blocks
    - no stucture provided. Mountable, Bootable
  - File storage
    - Presented as a file share
    - Has structure. Mountable, not Bootable
  - Object storage
    - Collection of objects
    - flat
    - Not mountable, not bootable
    - e.g. S3

- Storage Performance
  - IO (block) Size
    - Size of the blocks of size of data writing to storage
      - 16K, 64K, 1M, etc
  - IOPS
    - Number of IO operations it can achieve in a second
  - Throughput
    - IO Size * IOPS = Throughput
      - `16KB` Block size with `100IOPS` = `1.6MB/s`

## 1.6.5 Elastic Block Store (EBS)

- Allow block storage - was disk allocations
  - can be encrypted using KMS
  - instances see as block device and can create file systems on device (ext3/4,
    xfs)
- Storage is provisioned in **ONE AZ** (Resilient in that AZ)
- EBS attaches to \*one EC2 instance (or other service) over a storage network
  - \* Some storage types allow multi-attach to connect to multiple instances
    - Used for clusters
    - Has to be managed by application code to avoid overwriting data
- Can be detached and reattached, not lifecycle linked to on instance
  (persistent)
- Snapshot created into S3. Volumes can be created from snapshot to migrate
  between AZs
- Provision different types, sizes, performance profile etc
- Billed based on GB-month (and in some cases performance)
