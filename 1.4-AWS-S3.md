# 1.4 AWS S3

## 1.4.1 AWS S3 Security

- S3 is private by default. Any other permissions explicitly granted.
- S3 buckets use **resource** policies.
  - Like identity policies, but attached to a bucket
  - resource perspective permissions: who can access bucket, etc.
- Identity policies can only be attached to identities in own account;
  - Have no way using Identity policy to control access to another account
  - Attaching policy to resource allows controlling access to same and different
    accounts.
- Resource Policies allow/deny anonymous principals (anon access).

- S3 resource policies have express `"Principal"` inside of statement.

### When to use Identity vs Resource Policy
- Identity
  - Controlling many different resources
  - You have a preference for mananging permission in IAM
  - Using same account
- Resource/Bucket
  - Just controlling S3
  - Anonymous or Cross-Account
- ACLs: Never use unless absolutely need to

### Block Public Access

- Used as a big hammer for blocking public access. Bypasses any resource
  policies and locks down public access.

### Access Control Lists (ACLs)

- Legacy, AWS dont recommend; inflexible and simple permissions.

## 1.4.2 AWS S3 Static Hosting

- Static hosting requires an index and error document
- When static hosting is enabled on bucket, website endpoint is created
- Custom Domain name must match bucket name via R53

- Always consider offloading any large data to S3 bucket to avoid high compute
  costs. Cheaper to host from dedicated S3 than compute server. host from
  dedicated S3 than compute server.
- S3 is great for Out-of-band pages (maintenance page, server error etc)

## 1.4.3 Object Versioning

- Versioning allows multiple version of objects within a bucket.
- Versioning uses an id on each object and when object is overwritten (uses same
  key), the old version is retained with exisiting id, and new version is
  assigned new id. This newest version is the Latest Version or Current Version.
- If no id is specified, Latest Version is returned.
- **Cannot disable** object versioning on a bucket once enabled but can suspend
  versioning.

- Delete markers can be used to mark an object as 'deleted' but doesn't actually
  delete the object.
- Delete marker can also be removed to restore access to the previously deleted
  file and its version history.
- Version delete can be used to completely version of an object. If it is the
  latest version, it will be deleted and the previous version will become the
  Current Version.

### MFA Delete

- Is enabled in version configuration.
- When enabled, MFA is required to:
  - change bucket versioning state;
  - delete versions.
- Serial number (MFA) + Code passed with API Calls to make changes.

## 1.4.4 S3 Performance Optimization

- Single PUT uploads for large data is risky in S3.
  - Stream fails, upload fails.
  - Requires full restart.
  - Has max upload size of 5GB

- Multipart Upload solves issue with breaking data up.
  - Has a minimum data size of 100MB, recommended to use as soon as over
    threshold
  - 10,000 max parts, ranging from 5MB -> 5GB
  - Last part can be smaller than 5MB
  - Parts can fail and be restarted
  - Transfer rate = speeds of all parts

- S3 Transfer Acceleration, when enabled, transits data to its closest Edge
  Location which then propagates data to AWS via its global network which is
  often direct lines to destination.
  - Without S3 Transfer Acceleration, path of data to destination is out whim of
    ISP and global internet
  - S3 Transfer Accel has restrictions: bucket name cannot contain periods and
    needs to be DNS compatible in its naming.
  - Creates a specific endpoint that needs to be used.
