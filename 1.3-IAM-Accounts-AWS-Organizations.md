# 1.3 IAM-Accounts-AWS-Organizations

## 1.3.1 IAM Identity Policies

An IAM Identity Policy is a set of Security Statements to AWS.
- Grants access or denies access to AWS products or features to any identity
  that uses those products.

Policy documents made up of array of statements with the form:
- Sid: Optional Identifier of the resource
- Effect: "Allow" or "Deny" which controls the access policy of the statement.
- Action: Actions can match 1:m actions. Can be specific (`s3:OPERATION`) or
  can match wildcard operations (`s3:*`)
- Resource: array of resources, can be specific or wildcard.

Order of IAM Policy priority (DAD):
1. Explicit **DENY**
1. Explicit **ALLOW**
1. Default **DENY** (Implicit)

These are applied across the board, no matter how many policies match the
identity.

### Policy Types

- Inline Policies
  - Applied on individual identities.
  - Not best practice, doesn't scale.
  - Should be used for special or exceptional allow/deny
- Managed Policies
  - Configured policy rules that are reusable and have low management overhead.

## 1.3.2 IAM Users

IAM Users (principal) are an identity used for anything requiring **long-term** AWS
access. e.g:
- Human
- Application
- Service account

A principal first **authenticates** with AWS via the IAM service using either:
- Username and password; and/or
- Access Keys

Once authenticated, the values matched against for policy statements are used to
**authorise** the principal.

### Limitations of IAM Users

- **5,000** IAM users per account
- IAM User can be a member of up to **10 groups**

This affects system design wrt:
- Internet-scale applications
- Large orgs and org merges

Workarounds exist via **IAM Roles** and **Identity Federation**.

## 1.3.3 IAM Groups

IAM Groups are a container for IAM Users.

- Groups can have both **inline** and **managed** policies.
- Groups and user policies are gathered up and applied all at once in the DAD
  format.

### Limitations of IAM Groups

- No effective limit of number of users in an IAM Group.
- 300 groups per account (increased to 500 per support tickets).
- No global group containing all users; often expected from other identity
  systems.
- IAM Groups have no nesting.
- Cannot log into groups - no credentials.
- Groups are not a true identity - cannot be referenced as a principal in
  a policy.

## 1.3.4 IAM Roles

IAM Roles are assumed, the grantee becomes that role. IAM roles represent
a level of access inside of an AWS account.

IAM Roles has trust policies and permissions policies.
- **Trust policy**: *who* (users, services, accounts) can assume a role, acting as
  a "guest list".
  - Allows **authentication**.
- **Permissions policy**: *what* actions that role can perform once assumed,
  functioning as "access rules".
  - Allows **authorisation**.

When roles are assumed, they generate a temporary security credential that
expires after a fixed amount of time. After this time, the principal must
re-authenticate to re-assume the role.

### When and Where to use AWS Roles

- AWS Services, such as AWS Lambda.
  - Use Lambda Execution Role, which has a trust policy that trusts the Lambda
    Service.
  - Reason: Alternative would mean baking in access keys to the lambda to consume
    other service functionality. IAM Role gives this in a secure simple way.
- Emergency or out of usual scenarios.
  - Roles given to helpdesk are read-only, however there might exist
    a "Break-Glass" scenario where helpdesk requires write access.
    This is chosen as it shows intent to elevate permissions when it is absolutely
    needed.
- Adding AWS into existing corporate environment.
  - You **cannot** use external identities (facebook, google) to interface with
    AWS services.
- Web Identity Federation
  - Allow these identities to assume an AWS resource to access AWS services.
- Cross account usage
  - Your account has 1000s of identities and do not want to gives ids on partner
    account. Can assume Role in partner account instead.

### Service-Linked Roles

Service-linked roles are IAM roles that are linked to a **specific AWS
service** and are predefined by a service to provide permissions that that
service needs to interact with other AWS services on your behalf.

- You cannot delete a service-linked role until it is no longer required.

### PassRole

Permission on an arn of an IAM role to allow an principal to pass roles to a service in AWS.

## 1.3.5 AWS Organizations

A collection of AWS accounts, acting under one entity. Allows simple management
of billing and IAM across all accounts.

- Management/Master Account: Account used to create and manage org.
- Organization Root: top-level parent node that can contain org units and
  accounts
- Organization units: Logical groupings of AWS accounts within org to enable
  hierarchical management.
- orgs allows for consolidation of reservations and volume discounts accross
  accounts.
